id: TASK-211
title: Replace Modal.tsx with Radix Dialog
description: |-
    ## Overview
    Replace the custom Modal component with Radix Dialog while preserving existing CSS and behavior.

    ## Current Modal Implementation
    Location: web-react/src/components/overlays/Modal.tsx
    - Custom focus trap implementation
    - Portal to document.body
    - Escape key handling
    - Click outside to close
    - CSS classes: .modal-backdrop, .modal-content, .modal-title, .modal-close

    ## Radix Dialog Mapping

    ### Component Mapping
    | Current | Radix | CSS Class |
    |---------|-------|-----------|
    | Backdrop div | Dialog.Overlay | .modal-backdrop |
    | Content div | Dialog.Content | .modal-content |
    | Title | Dialog.Title | .modal-title |
    | Close button | Dialog.Close | .modal-close |
    | - | Dialog.Portal | (handles portal) |
    | - | Dialog.Root | (handles open state) |

    ### Animation Preservation
    Current animations to preserve:
    ```css
    /* Backdrop fade-in */
    .modal-backdrop {
      animation: fade-in var(--duration-normal) var(--ease-out);
    }

    /* Content slide-up */
    .modal-content {
      animation: modal-content-in var(--duration-normal) var(--ease-out);
    }

    @keyframes modal-content-in {
      from {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    ```

    Map to Radix data-state:
    ```css
    .modal-backdrop[data-state='open'] {
      animation: fade-in var(--duration-normal) var(--ease-out);
    }

    .modal-content[data-state='open'] {
      animation: modal-content-in var(--duration-normal) var(--ease-out);
    }

    /* Optional: exit animations */
    .modal-backdrop[data-state='closed'] {
      animation: fade-out var(--duration-fast) var(--ease-in);
    }

    .modal-content[data-state='closed'] {
      animation: modal-content-out var(--duration-fast) var(--ease-in);
    }
    ```

    ## Implementation

    ### New Modal Component
    ```tsx
    import * as Dialog from '@radix-ui/react-dialog';

    interface ModalProps {
      open: boolean;
      onClose: () => void;
      title?: string;
      size?: 'sm' | 'md' | 'lg' | 'xl';
      children: React.ReactNode;
    }

    export function Modal({ open, onClose, title, size = 'md', children }: ModalProps) {
      return (
        <Dialog.Root open={open} onOpenChange={(o) => !o && onClose()}>
          <Dialog.Portal>
            <Dialog.Overlay className="modal-backdrop" />
            <Dialog.Content className={`modal-content modal-${size}`}>
              {title && <Dialog.Title className="modal-title">{title}</Dialog.Title>}
              <Dialog.Close className="modal-close" aria-label="Close">
                <Icon name="x" />
              </Dialog.Close>
              {children}
            </Dialog.Content>
          </Dialog.Portal>
        </Dialog.Root>
      );
    }
    ```

    ## Accessibility Improvements
    Radix provides automatically:
    - Focus trap (Tab cycles within modal)
    - Return focus to trigger on close
    - aria-modal="true"
    - aria-labelledby linking to title
    - Escape key closes modal
    - Click outside closes modal

    ## Success Criteria
    - Modal works identically to current implementation
    - All existing Modal usages work without changes
    - Focus trap works correctly
    - Escape key closes modal
    - Click outside closes modal
    - Focus returns to trigger after close

    ## Test Criteria

    ### Unit Tests
    - Modal opens when open=true
    - Modal closes when onClose called
    - Title renders when provided
    - Size classes apply correctly
    - Children render inside content

    ### Keyboard Accessibility Tests
    - Tab cycles only within modal (focus trap)
    - Shift+Tab reverse cycles
    - Escape closes modal
    - Focus returns to trigger element after close

    ### E2E Tests
    - bunx playwright test (all modal-using tests pass)
    - NewTaskModal works
    - CommandPalette works
    - TaskEditModal works
weight: medium
status: paused
current_phase: spec
branch: orc/TASK-211
queue: active
priority: high
category: refactor
initiative_id: INIT-009
blocked_by:
    - TASK-210
requires_ui_testing: true
testing_requirements:
    unit: true
    visual: true
created_at: 2026-01-14T23:05:04.333212064-06:00
updated_at: 2026-01-14T23:21:08.116461531-06:00
started_at: 2026-01-14T23:16:32.431443098-06:00
