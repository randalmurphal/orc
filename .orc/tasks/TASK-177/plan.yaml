version: 1
task_id: ""
weight: large
description: Large task - spec, implement, test, validate with E2E testing
phases:
    - id: implement
      name: implement
      prompt: |
        Implement the large task according to the specification:

        **Task**: {{TASK_TITLE}}

        **Description**: {{TASK_DESCRIPTION}}

        **Specification**:
        {{SPEC_CONTENT}}

        {{RETRY_CONTEXT}}

        Implementation protocol:
        1. Implement all components defined in the spec
        2. Write unit tests alongside code
        3. Run tests frequently: `go test ./... -v -race`
        4. Fix failures before continuing
        5. If frontend exists:
           - Implement all components
           - Add loading/error states
           - Integrate with API

        Keep iterating until:
        - All components implemented
        - All unit tests pass
        - No race conditions

        When done, output:
        <phase_complete>true</phase_complete>
      depends_on:
        - spec
      gate:
        type: auto
      checkpoint: true
      status: completed
      commit_sha: 3c3117cd279e15eec4e2d26ff0efe46d25acc68a
    - id: test
      name: test
      prompt: |
        Comprehensive testing for:

        **Task**: {{TASK_TITLE}}

        **Description**: {{TASK_DESCRIPTION}}

        ## Unit Tests
        1. Run: `go test ./... -v -race -cover`
        2. Verify coverage > 80%
        3. Fix any failures

        ## Integration Tests
        1. Test component interactions
        2. Test error handling paths
        3. Verify data flows correctly

        ## E2E Tests (If frontend exists - Use Playwright MCP tools)

        Setup:
        - Start backend server
        - Start frontend server

        Test using Playwright MCP:
        1. `mcp__playwright__browser_navigate` to app URL
        2. `mcp__playwright__browser_snapshot` to verify state
        3. `mcp__playwright__browser_click` to interact
        4. `mcp__playwright__browser_type` for input
        5. `mcp__playwright__browser_wait_for` for async operations

        Critical scenarios:
        - Happy path user flow
        - Error handling
        - Edge cases

        Keep iterating until all tests pass.

        When done, output:
        <phase_complete>true</phase_complete>
      depends_on:
        - implement
      gate:
        type: auto
      checkpoint: true
      status: pending
    - id: docs
      name: docs
      prompt: |
        Update documentation for:

        **Task**: {{TASK_TITLE}}

        **Description**: {{TASK_DESCRIPTION}}

        1. Update any relevant documentation files
        2. Ensure CLAUDE.md reflects the changes if applicable
        3. Add/update code comments where needed
        4. Update README if user-facing changes were made

        Keep iterating until documentation is complete.

        When done, output:
        <phase_complete>true</phase_complete>
      depends_on:
        - test
      gate:
        type: auto
      checkpoint: true
      status: pending
    - id: validate
      name: validate
      prompt: |
        Final validation for:

        **Task**: {{TASK_TITLE}}

        **Description**: {{TASK_DESCRIPTION}}

        ## Validation Checklist

        ### Code
        - [ ] All requirements from spec are met
        - [ ] Unit tests pass: `go test ./... -v -race`
        - [ ] Test coverage > 80%
        - [ ] No race conditions
        - [ ] Code quality acceptable (no debug statements, TODOs)

        ### Integration
        - [ ] Components work together
        - [ ] Error handling is complete
        - [ ] Performance is acceptable

        ### E2E (If frontend - MUST RUN with Playwright MCP)
        - [ ] Main user flows work
        - [ ] Error states handled
        - [ ] UI updates correctly

        ### Documentation
        - [ ] Code is documented where needed
        - [ ] CLAUDE.md updated if necessary
        - [ ] API documented if applicable

        ## Final Verification

        If frontend exists, run E2E verification:
        1. Start all servers
        2. Use Playwright MCP tools to test all features
        3. Verify everything works end-to-end

        Keep iterating until validation passes.

        When done, output:
        <phase_complete>true</phase_complete>
      depends_on:
        - docs
      gate:
        type: auto
      checkpoint: true
      status: pending
