version: 2
exported_at: 2026-01-17T08:29:48.011808-06:00
task:
    id: TASK-189
    title: 'CRITICAL: Worktree cleanup must NEVER touch main repo/branch'
    description: "## Problem\nWhen a task completes in a worktree, something in the cleanup/sync process is resetting or modifying the main repository branch. This caused loss of uncommitted work on main.\n\nEvidence from reflog:\n```\nreset: moving to HEAD~1\nreset: moving to HEAD~1  \nreset: moving to origin/main\n```\n\nThis is UNACCEPTABLE. The worktree system exists specifically to isolate task execution from the main repo.\n\n## Root Cause Investigation Needed\n1. Check worktree cleanup in internal/git/worktree.go\n2. Check completion sync in internal/git/sync.go\n3. Check if any code does `git checkout main` or `git reset` in main repo context\n4. Check the .orc/ restoration logic from TASK-115\n\n## Requirements\n1. Worktree operations must NEVER affect main repo\n2. No git reset, checkout, or destructive ops on main\n3. Add safeguards to detect if accidentally in main repo\n4. Add tests to verify main repo is untouched after task completion\n\n## Success Criteria\n1. Run a task to completion - main branch unchanged\n2. Parallel tasks - main branch unchanged\n3. Failed tasks - main branch unchanged\n4. Add integration test that verifies main repo integrity"
    weight: medium
    status: completed
    branch: orc/TASK-189
    queue: active
    priority: critical
    category: bug
    created_at: 2026-01-14T02:33:13-06:00
    updated_at: 0001-01-01T00:00:00Z
    started_at: 2026-01-14T03:31:03-06:00
plan:
    version: 1
    task_id: TASK-189
    weight: medium
    description: Medium task - implement with review, fully automated
    phases:
        - id: implement
          name: implement
          prompt: |
            Implement the following feature/task:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            {{RETRY_CONTEXT}}

            1. Plan your implementation approach
            2. Implement the required changes
            3. Write/update tests alongside code
            4. Run tests and fix any failures

            Keep iterating until implementation is complete and tests pass.

            When done, output:
            <phase_complete>true</phase_complete>
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: test
          name: test
          prompt: |
            Test and review the implementation:

            **Task**: {{TASK_TITLE}}

            **Original task**: {{TASK_DESCRIPTION}}

            1. Run the full test suite
            2. Review code for quality issues
            3. Check for edge cases and security issues
            4. Fix any problems found

            Keep iterating until all tests pass and code quality is acceptable.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - implement
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: docs
          name: docs
          prompt: |
            Update documentation for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            1. Update any relevant documentation files
            2. Ensure CLAUDE.md reflects the changes if applicable
            3. Add/update code comments where needed
            4. Update README if user-facing changes were made

            Keep iterating until documentation is complete.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - test
          gate:
            type: auto
          checkpoint: true
          status: pending
state:
    task_id: TASK-189
    current_phase: ""
    current_iteration: 0
    status: pending
    started_at: 2026-01-14T03:31:03-06:00
    updated_at: 0001-01-01T00:00:00Z
    phases:
        implement:
            status: pending
            iterations: 0
            tokens:
                input_tokens: 0
                output_tokens: 0
                total_tokens: 0
        test:
            status: pending
            iterations: 0
            tokens:
                input_tokens: 0
                output_tokens: 0
                total_tokens: 0
    tokens:
        input_tokens: 0
        output_tokens: 0
        total_tokens: 0
    cost:
        total_cost_usd: 0
