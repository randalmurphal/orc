version: 2
exported_at: 2026-01-17T08:29:45.925779-06:00
task:
    id: TASK-341
    title: Update router configuration for new layout
    description: |-
        Update the router configuration to use the new AppShell layout and add new routes.

        REFERENCE FILES:
        - Current router: web/src/router/routes.tsx
        - docs/specs/UI_REDESIGN_ARCHITECTURE.md (routes section)

        TYPESCRIPT INTERFACES:
        ```typescript
        interface RouteConfig {
          path: string;
          element: React.ReactNode;
          children?: RouteConfig[];
          loader?: LoaderFunction;
          errorElement?: React.ReactNode;
        }
        ```

        NEW ROUTE STRUCTURE:
        ```typescript
        import { createBrowserRouter, Navigate, Outlet } from "react-router-dom";
        import { AppShell } from "@/components/layout/AppShell";
        import { BoardPage } from "@/pages/BoardPage";
        import { InitiativesPage } from "@/pages/InitiativesPage";
        import { InitiativeDetailPage } from "@/pages/InitiativeDetailPage";
        import { StatsPage } from "@/pages/StatsPage";
        import { AgentsPage } from "@/pages/AgentsPage";
        import { SettingsPage } from "@/pages/SettingsPage";
        import { TaskDetailPage } from "@/pages/TaskDetailPage";
        import { ErrorBoundary } from "@/components/ErrorBoundary";
        import { NotFoundPage } from "@/pages/NotFoundPage";

        export const router = createBrowserRouter([
          {
            path: "/",
            element: <AppShell><Outlet /></AppShell>,
            errorElement: <ErrorBoundary />,
            children: [
              { index: true, element: <Navigate to="/board" replace /> },
              { path: "board", element: <BoardPage /> },
              { path: "initiatives", element: <InitiativesPage /> },
              { path: "initiatives/:id", element: <InitiativeDetailPage /> },
              { path: "stats", element: <StatsPage /> },
              { path: "agents", element: <AgentsPage /> },
              {
                path: "settings",
                element: <SettingsPage />,
                children: [
                  { index: true, element: <Navigate to="/settings/prompts/system" replace /> },
                  { path: "prompts/:section", element: <PromptsSection /> },
                  { path: "configuration/:section", element: <ConfigSection /> },
                  { path: "automation/:section", element: <AutomationSection /> },
                  { path: "advanced/:section", element: <AdvancedSection /> },
                ],
              },
              { path: "tasks/:id", element: <TaskDetailPage /> },
              { path: "*", element: <NotFoundPage /> },
            ],
          },
        ]);
        ```

        SUCCESS CRITERIA:
        1. Router configuration at web/src/router/routes.tsx updated
        2. All views wrapped in AppShell
        3. Index route redirects to /board
        4. Settings has nested routes for sections
        5. 404 page for unmatched routes
        6. Error boundary for route errors
        7. Existing task detail route preserved
        8. npm run build exits 0

        ROUTE BEHAVIORS:
        - /board: Main dashboard with kanban board
        - /initiatives: Initiative list with stats
        - /initiatives/:id: Initiative detail with tasks
        - /stats: Analytics dashboard
        - /agents: Agent configuration
        - /settings/*: Settings with sidebar navigation
        - /tasks/:id: Task detail (existing)

        KEYBOARD SHORTCUTS:
        Update shortcut handlers in web/src/lib/shortcuts.ts:
        - g b -> navigate to /board
        - g i -> navigate to /initiatives
        - g s -> navigate to /stats
        - g a -> navigate to /agents
        - g , -> navigate to /settings

        MIGRATION:
        1. Keep existing route handlers that work
        2. Add new routes for new pages
        3. Update AppShell wrapper
        4. Add redirect from old paths if any

        EDGE CASES:
        - Handle deep links (direct navigation to /settings/prompts/commands)
        - Preserve URL state on refresh
        - Handle 404 gracefully
        - Support browser back/forward

        FILES TO MODIFY:
        - web/src/router/routes.tsx
        - web/src/lib/shortcuts.ts
        - web/src/App.tsx (if needed)
    weight: small
    status: planned
    branch: orc/TASK-341
    queue: active
    priority: high
    category: refactor
    initiative_id: INIT-016
    blocked_by:
        - TASK-338
    created_at: 2026-01-16T20:57:29-06:00
    updated_at: 0001-01-01T00:00:00Z
plan:
    version: 1
    task_id: TASK-341
    weight: small
    description: Small task - implement with tests, fully automated
    phases:
        - id: implement
          name: implement
          prompt: |
            Implement the following task:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            {{RETRY_CONTEXT}}

            1. Implement the required changes
            2. Write/update tests as needed
            3. Run tests and fix any failures

            Keep iterating until implementation is complete and all tests pass.

            When done, output:
            <phase_complete>true</phase_complete>
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: test
          name: test
          prompt: |
            Final test verification for: {{TASK_TITLE}}

            **Original task**: {{TASK_DESCRIPTION}}

            1. Run the full test suite
            2. Fix any failures found
            3. Verify edge cases are covered

            Keep iterating until all tests pass.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - implement
          gate:
            type: auto
          checkpoint: true
          status: pending
state:
    task_id: TASK-341
    current_phase: ""
    current_iteration: 0
    status: pending
    started_at: 0001-01-01T00:00:00Z
    updated_at: 0001-01-01T00:00:00Z
    phases: {}
    tokens:
        input_tokens: 0
        output_tokens: 0
        total_tokens: 0
    cost:
        total_cost_usd: 0
