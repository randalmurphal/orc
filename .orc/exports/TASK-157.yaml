version: 2
exported_at: 2026-01-17T22:16:48.242737518-06:00
task:
    id: TASK-157
    title: 'Phase 0: Expand E2E tests for WebSocket real-time updates (12 tests)'
    description: |-
        ## Purpose
        E2E tests for WebSocket integration and real-time UI updates - CRITICAL for migration success.

        ## Test Coverage (12 tests)

        ### Task Lifecycle Updates (5 tests)
        - should update task card when task status changes via WebSocket
        - should move card to new column when phase changes
        - should show toast notification on task creation event
        - should remove card when task deleted event received
        - should update progress indicators during task running

        ### Live Transcript (4 tests)
        - should open live transcript modal when clicking running task
        - should show streaming content in real-time
        - should display connection status (Live/Connecting/Disconnected)
        - should update token counts during execution

        ### Connection Handling (3 tests)
        - should reconnect automatically after disconnect
        - should show reconnecting banner/status
        - should resume updates after reconnection

        ## Implementation Notes
        - Use Playwright network interception or real WebSocket connections
        - May need test fixtures that trigger real task execution
        - Verify event types: state, transcript, phase, tokens, complete, task_created, task_updated, task_deleted

        ## Success Criteria
        - All 12 tests pass reliably (no flaky tests)
        - Tests verify actual WebSocket behavior, not mocked
    weight: large
    status: completed
    current_phase: validate
    branch: orc/TASK-157
    queue: active
    priority: normal
    category: test
    initiative_id: INIT-005
    created_at: 2026-01-14T02:18:14-06:00
    updated_at: 0001-01-01T00:00:00Z
    started_at: 2026-01-14T21:38:15-06:00
    completed_at: 2026-01-14T21:58:17-06:00
plan:
    version: 1
    task_id: TASK-157
    weight: large
    description: Large task - spec, implement, test, validate with E2E testing
    phases:
        - id: spec
          name: spec
          prompt: |
            Create a specification for this large task:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            Define:
            1. Requirements and scope
            2. Technical approach
            3. Component breakdown (backend, frontend if applicable)
            4. API design (if applicable)
            5. Success criteria with explicit checkboxes
            6. Testing strategy:
               - Unit tests
               - Integration tests
               - E2E tests (using Playwright MCP tools if frontend exists)

            Include clear completion criteria:
            - What code must be written
            - What tests must pass
            - What E2E scenarios must work
            - What documentation must exist

            Keep iterating until the specification is clear and complete.

            When done, output:
            <phase_complete>true</phase_complete>
          gate:
            type: auto
          checkpoint: true
          status: completed
          commit_sha: a524494957d3cd55bb158b255b9a6bc14fcf41ff
        - id: implement
          name: implement
          prompt: |
            Implement the large task according to the specification:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            **Specification**:
            {{SPEC_CONTENT}}

            {{RETRY_CONTEXT}}

            Implementation protocol:
            1. Implement all components defined in the spec
            2. Write unit tests alongside code
            3. Run tests frequently: `go test ./... -v -race`
            4. Fix failures before continuing
            5. If frontend exists:
               - Implement all components
               - Add loading/error states
               - Integrate with API

            Keep iterating until:
            - All components implemented
            - All unit tests pass
            - No race conditions

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - spec
          gate:
            type: auto
          checkpoint: true
          status: completed
          commit_sha: c57dae30401838ce013d80861745b17edfcb7108
        - id: test
          name: test
          prompt: |
            Comprehensive testing for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            ## Unit Tests
            1. Run: `go test ./... -v -race -cover`
            2. Verify coverage > 80%
            3. Fix any failures

            ## Integration Tests
            1. Test component interactions
            2. Test error handling paths
            3. Verify data flows correctly

            ## E2E Tests (If frontend exists - Use Playwright MCP tools)

            Setup:
            - Start backend server
            - Start frontend server

            Test using Playwright MCP:
            1. `mcp__playwright__browser_navigate` to app URL
            2. `mcp__playwright__browser_snapshot` to verify state
            3. `mcp__playwright__browser_click` to interact
            4. `mcp__playwright__browser_type` for input
            5. `mcp__playwright__browser_wait_for` for async operations

            Critical scenarios:
            - Happy path user flow
            - Error handling
            - Edge cases

            Keep iterating until all tests pass.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - implement
          gate:
            type: auto
          checkpoint: true
          status: completed
          commit_sha: c7f3df4050c634b7c70e6f763fc648456ffa9a66
        - id: docs
          name: docs
          prompt: |
            Update documentation for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            1. Update any relevant documentation files
            2. Ensure CLAUDE.md reflects the changes if applicable
            3. Add/update code comments where needed
            4. Update README if user-facing changes were made

            Keep iterating until documentation is complete.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - test
          gate:
            type: auto
          checkpoint: true
          status: completed
          commit_sha: bee4a1aae9fb459c168b64c46f3b6a23125da3bd
        - id: validate
          name: validate
          prompt: |
            Final validation for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            ## Validation Checklist

            ### Code
            - [ ] All requirements from spec are met
            - [ ] Unit tests pass: `go test ./... -v -race`
            - [ ] Test coverage > 80%
            - [ ] No race conditions
            - [ ] Code quality acceptable (no debug statements, TODOs)

            ### Integration
            - [ ] Components work together
            - [ ] Error handling is complete
            - [ ] Performance is acceptable

            ### E2E (If frontend - MUST RUN with Playwright MCP)
            - [ ] Main user flows work
            - [ ] Error states handled
            - [ ] UI updates correctly

            ### Documentation
            - [ ] Code is documented where needed
            - [ ] CLAUDE.md updated if necessary
            - [ ] API documented if applicable

            ## Final Verification

            If frontend exists, run E2E verification:
            1. Start all servers
            2. Use Playwright MCP tools to test all features
            3. Verify everything works end-to-end

            Keep iterating until validation passes.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - docs
          gate:
            type: auto
          checkpoint: true
          status: completed
          commit_sha: f176df5893fb7b4acbf3687c281a669775c30455
state:
    task_id: TASK-157
    current_phase: validate
    current_iteration: 0
    status: completed
    started_at: 2026-01-14T21:38:15-06:00
    updated_at: 0001-01-01T00:00:00Z
    phases:
        docs:
            status: completed
            started_at: 2026-01-14T21:53:05-06:00
            completed_at: 2026-01-14T21:54:15-06:00
            iterations: 1
            commit_sha: bee4a1aae9fb459c168b64c46f3b6a23125da3bd
            tokens:
                input_tokens: 901385
                output_tokens: 2199
                total_tokens: 0
        implement:
            status: completed
            started_at: 2026-01-14T21:40:04-06:00
            completed_at: 2026-01-14T21:49:43-06:00
            iterations: 1
            commit_sha: c57dae30401838ce013d80861745b17edfcb7108
            tokens:
                input_tokens: 3601091
                output_tokens: 7830
                total_tokens: 0
        spec:
            status: completed
            started_at: 2026-01-14T21:38:16-06:00
            completed_at: 2026-01-14T21:40:04-06:00
            iterations: 1
            commit_sha: a524494957d3cd55bb158b255b9a6bc14fcf41ff
            tokens:
                input_tokens: 840765
                output_tokens: 5057
                total_tokens: 0
        test:
            status: completed
            started_at: 2026-01-14T21:49:43-06:00
            completed_at: 2026-01-14T21:53:05-06:00
            iterations: 1
            commit_sha: c7f3df4050c634b7c70e6f763fc648456ffa9a66
            tokens:
                input_tokens: 711635
                output_tokens: 2683
                total_tokens: 0
        validate:
            status: completed
            started_at: 2026-01-14T21:54:15-06:00
            completed_at: 2026-01-14T21:58:17-06:00
            iterations: 1
            commit_sha: f176df5893fb7b4acbf3687c281a669775c30455
            tokens:
                input_tokens: 684934
                output_tokens: 2955
                total_tokens: 0
    gates:
        - phase: spec
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:40:04-06:00
        - phase: spec
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:40:04-06:00
        - phase: spec
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:40:04-06:00
        - phase: spec
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:40:04-06:00
        - phase: implement
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:49:43-06:00
        - phase: implement
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:49:43-06:00
        - phase: implement
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:49:43-06:00
        - phase: implement
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:49:43-06:00
        - phase: test
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:53:05-06:00
        - phase: test
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:53:05-06:00
        - phase: test
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:53:05-06:00
        - phase: test
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:53:05-06:00
        - phase: docs
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:54:15-06:00
        - phase: docs
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:54:15-06:00
        - phase: docs
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:54:15-06:00
        - phase: docs
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:54:15-06:00
        - phase: validate
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:58:17-06:00
        - phase: validate
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:58:17-06:00
        - phase: validate
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:58:17-06:00
        - phase: validate
          gate_type: auto
          approved: true
          reason: auto-approved on success
          timestamp: 2026-01-14T21:58:17-06:00
    tokens:
        input_tokens: 0
        output_tokens: 0
        total_tokens: 0
    cost:
        total_cost_usd: 0
gate_decisions:
    - id: 53
      taskid: TASK-157
      phase: spec
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:40:04-06:00
    - id: 54
      taskid: TASK-157
      phase: spec
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:40:04-06:00
    - id: 63
      taskid: TASK-157
      phase: spec
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:40:04-06:00
    - id: 64
      taskid: TASK-157
      phase: spec
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:40:04-06:00
    - id: 55
      taskid: TASK-157
      phase: implement
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:49:43-06:00
    - id: 56
      taskid: TASK-157
      phase: implement
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:49:43-06:00
    - id: 65
      taskid: TASK-157
      phase: implement
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:49:43-06:00
    - id: 66
      taskid: TASK-157
      phase: implement
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:49:43-06:00
    - id: 57
      taskid: TASK-157
      phase: test
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:53:05-06:00
    - id: 58
      taskid: TASK-157
      phase: test
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:53:05-06:00
    - id: 67
      taskid: TASK-157
      phase: test
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:53:05-06:00
    - id: 68
      taskid: TASK-157
      phase: test
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:53:05-06:00
    - id: 59
      taskid: TASK-157
      phase: docs
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:54:15-06:00
    - id: 60
      taskid: TASK-157
      phase: docs
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:54:15-06:00
    - id: 69
      taskid: TASK-157
      phase: docs
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:54:15-06:00
    - id: 70
      taskid: TASK-157
      phase: docs
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:54:15-06:00
    - id: 61
      taskid: TASK-157
      phase: validate
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:58:17-06:00
    - id: 62
      taskid: TASK-157
      phase: validate
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:58:17-06:00
    - id: 71
      taskid: TASK-157
      phase: validate
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:58:17-06:00
    - id: 72
      taskid: TASK-157
      phase: validate
      gatetype: auto
      approved: true
      reason: auto-approved on success
      decidedby: ""
      decidedat: 2026-01-14T21:58:17-06:00
