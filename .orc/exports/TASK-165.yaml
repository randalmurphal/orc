version: 2
exported_at: 2026-01-17T22:16:48.237354119-06:00
task:
    id: TASK-165
    title: 'Phase 1: Create useWebSocket hook and WebSocketProvider'
    description: |-
        ## Purpose
        Port the WebSocket client to React with proper hook-based API.

        ## Implementation

        ### WebSocket Client (port from websocket.ts)
        - OrcWebSocket class (keep similar structure)
        - Connection lifecycle: connect, reconnect, disconnect
        - Subscription model: global (*) vs task-specific
        - Auto-reconnect with exponential backoff
        - Ping/pong heartbeat (30s interval)
        - Primary subscription restoration on reconnect

        ### React Integration

        #### WebSocketProvider
        - Context provider wrapping app
        - Manages single WebSocket instance
        - Exposes connection status

        #### useWebSocket hook
        ```typescript
        const { status, subscribe, unsubscribe } = useWebSocket()
        ```

        #### useTaskSubscription hook
        ```typescript
        const { state, transcript } = useTaskSubscription('TASK-001')
        ```

        ### Event Handling
        - state -> update TaskStore
        - transcript -> streaming to component
        - task_created/updated/deleted -> update TaskStore
        - error -> toast notification

        ## Success Criteria
        - WebSocket connects and reconnects correctly
        - Events update stores in real-time
        - Connection status visible in UI
        - No memory leaks on unmount
    weight: medium
    status: completed
    current_phase: implement
    branch: orc/TASK-165
    queue: active
    priority: normal
    category: feature
    initiative_id: INIT-005
    blocked_by:
        - TASK-163
    created_at: 2026-01-14T02:20:25-06:00
    updated_at: 0001-01-01T00:00:00Z
    started_at: 2026-01-14T11:24:53-06:00
plan:
    version: 1
    task_id: TASK-165
    weight: medium
    description: Medium task - implement with review, fully automated
    phases:
        - id: implement
          name: implement
          prompt: |
            Implement the following feature/task:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            {{RETRY_CONTEXT}}

            1. Plan your implementation approach
            2. Implement the required changes
            3. Write/update tests alongside code
            4. Run tests and fix any failures

            Keep iterating until implementation is complete and tests pass.

            When done, output:
            <phase_complete>true</phase_complete>
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: test
          name: test
          prompt: |
            Test and review the implementation:

            **Task**: {{TASK_TITLE}}

            **Original task**: {{TASK_DESCRIPTION}}

            1. Run the full test suite
            2. Review code for quality issues
            3. Check for edge cases and security issues
            4. Fix any problems found

            Keep iterating until all tests pass and code quality is acceptable.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - implement
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: docs
          name: docs
          prompt: |
            Update documentation for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            1. Update any relevant documentation files
            2. Ensure CLAUDE.md reflects the changes if applicable
            3. Add/update code comments where needed
            4. Update README if user-facing changes were made

            Keep iterating until documentation is complete.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - test
          gate:
            type: auto
          checkpoint: true
          status: pending
state:
    task_id: TASK-165
    current_phase: implement
    current_iteration: 0
    status: running
    started_at: 2026-01-14T11:24:53-06:00
    updated_at: 0001-01-01T00:00:00Z
    phases:
        implement:
            status: running
            started_at: 2026-01-14T11:24:54-06:00
            iterations: 0
            tokens:
                input_tokens: 0
                output_tokens: 0
                total_tokens: 0
    tokens:
        input_tokens: 0
        output_tokens: 0
        total_tokens: 0
    cost:
        total_cost_usd: 0
