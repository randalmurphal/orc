version: 2
exported_at: 2026-01-16T23:27:36.880263277-06:00
task:
    id: TASK-412
    title: Create CostAnalyticsView page
    description: "Create the main Cost Analytics page at /costs route.\n\n**ROUTE:** /costs\n\n**PAGE LAYOUT:**\n```\n┌──────────────────────────────────────────────────────────────────┐\n│ Cost Analytics                              [Export CSV] [⚙]    │\n│ Token usage, costs, and budget tracking                          │\n├──────────────────────────────────────────────────────────────────┤\n│  24h  │  7d  │  30d  │  All  │  Custom                          │\n├──────────────────────────────────────────────────────────────────┤\n│ ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────────┐ │\n│ │ Total Cost │ │ Tokens Used│ │ Avg/Task   │ │ Monthly Budget │ │\n│ │ $156.78    │ │ 1.2M       │ │ $4.52      │ │ 47% of $500   │ │\n│ │ +12% ▲     │ │ +8% ▲      │ │ -5% ▼      │ │ On track ✓    │ │\n│ └────────────┘ └────────────┘ └────────────┘ └────────────────┘ │\n├──────────────────────────────────────────────────────────────────┤\n│ ┌─────────────────────────────┐ ┌────────────────────────────┐  │\n│ │     Cost Over Time          │ │    Cost by Model           │  │\n│ │  [Line chart with trends]   │ │  [Donut chart]             │  │\n│ │                             │ │     Opus 76%               │  │\n│ │  $50 ─────────╮             │ │     Sonnet 22%             │  │\n│ │  $25 ────╮    │             │ │     Haiku 2%               │  │\n│ │   $0 ────┴────┴─────────    │ │                            │  │\n│ │       Jan 1      Jan 15     │ │                            │  │\n│ └─────────────────────────────┘ └────────────────────────────┘  │\n├──────────────────────────────────────────────────────────────────┤\n│ Cost Breakdown                                     [By ▾] Model  │\n│ ┌────────────────────────────────────────────────────────────┐  │\n│ │ Initiative        │ Tasks │ Tokens  │ Cost    │ Avg/Task  │  │\n│ ├────────────────────────────────────────────────────────────┤  │\n│ │ UI Redesign       │ 52    │ 500K    │ $45.67  │ $0.88     │  │\n│ │ Backend API       │ 8     │ 120K    │ $12.30  │ $1.54     │  │\n│ │ ...               │       │         │         │           │  │\n│ └────────────────────────────────────────────────────────────┘  │\n└──────────────────────────────────────────────────────────────────┘\n```\n\n**DATA FETCHING:**\n```typescript\nconst { data: breakdown } = useQuery(['cost', 'breakdown', period, groupBy], \n  () => api.getCostBreakdown({ period, by: groupBy }));\n\nconst { data: timeseries } = useQuery(['cost', 'timeseries', period], \n  () => api.getCostTimeseries({ ...period, granularity: 'day' }));\n\nconst { data: budget } = useQuery(['cost', 'budget'], \n  () => api.getCostBudget());\n```\n\n**FEATURES:**\n1. Period selector (24h, 7d, 30d, All, Custom)\n2. Stats cards row (total, tokens, avg, budget)\n3. Timeseries chart with model toggle\n4. Model breakdown donut\n5. Drill-down table (by initiative, task, phase)\n6. Export to CSV\n7. Budget edit modal\n\n**GROUP BY OPTIONS:**\n- Model (default)\n- Phase\n- Initiative\n- Task\n\n**FILES TO CREATE:**\n- web/src/pages/CostAnalyticsPage.tsx\n- web/src/components/cost/CostAnalyticsView.tsx\n- web/src/components/cost/CostBreakdownTable.tsx\n- web/src/components/cost/BudgetEditModal.tsx\n- Update web/src/router/routes.tsx\n\n**SUCCESS CRITERIA:**\n1. All charts render with data\n2. Period selector changes all data\n3. Group by changes table\n4. Export generates valid CSV\n5. Budget modal saves limit\n6. Responsive layout\n7. Loading and error states"
    weight: large
    status: planned
    branch: orc/TASK-412
    queue: active
    priority: normal
    category: feature
    initiative_id: INIT-026
    blocked_by:
        - TASK-408
        - TASK-409
        - TASK-410
        - TASK-411
    created_at: 2026-01-16T23:01:24-06:00
    updated_at: 0001-01-01T00:00:00Z
plan:
    version: 1
    task_id: TASK-412
    weight: large
    description: Large task - spec, design, implement, review, test, docs, validate with multi-agent code review
    phases:
        - id: spec
          name: spec
          prompt: |
            Create a specification for this large task:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            Define:
            1. Requirements and scope
            2. Technical approach
            3. Component breakdown (backend, frontend if applicable)
            4. API design (if applicable)
            5. Success criteria with explicit checkboxes
            6. Testing strategy:
               - Unit tests
               - Integration tests
               - E2E tests (using Playwright MCP tools if frontend exists)

            Include clear completion criteria:
            - What code must be written
            - What tests must pass
            - What E2E scenarios must work
            - What documentation must exist

            Keep iterating until the specification is clear and complete.

            When done, output:
            <phase_complete>true</phase_complete>
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: design
          name: design
          prompt: |
            Create architecture and design for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            **Specification**:
            {{SPEC_CONTENT}}

            Design requirements:
            1. Define components and their responsibilities
            2. Document design decisions with rationale
            3. Assess implementation risks
            4. Define implementation order

            Output a design document with:
            - Component architecture
            - Design decisions table (DD-1, DD-2, etc.)
            - Risk assessment
            - Implementation order

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - spec
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: implement
          name: implement
          prompt: |
            Implement the large task according to the specification and design:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            **Specification**:
            {{SPEC_CONTENT}}

            **Design**:
            {{DESIGN_CONTENT}}

            {{RETRY_CONTEXT}}

            Implementation protocol:
            1. Follow the design's implementation order
            2. Implement all components defined in the spec
            3. Write unit tests alongside code
            4. Run tests frequently: `go test ./... -v -race`
            5. Fix failures before continuing
            6. If frontend exists:
               - Implement all components
               - Add loading/error states
               - Integrate with API

            Keep iterating until:
            - All components implemented
            - All unit tests pass
            - No race conditions

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - design
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: review
          name: review
          prompt: ""
          depends_on:
            - implement
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: test
          name: test
          prompt: |
            Comprehensive testing for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            ## Unit Tests
            1. Run: `go test ./... -v -race -cover`
            2. Verify coverage > 80%
            3. Fix any failures

            ## Integration Tests
            1. Test component interactions
            2. Test error handling paths
            3. Verify data flows correctly

            ## E2E Tests (If frontend exists - Use Playwright MCP tools)

            Setup:
            - Start backend server
            - Start frontend server

            Test using Playwright MCP:
            1. `mcp__playwright__browser_navigate` to app URL
            2. `mcp__playwright__browser_snapshot` to verify state
            3. `mcp__playwright__browser_click` to interact
            4. `mcp__playwright__browser_type` for input
            5. `mcp__playwright__browser_wait_for` for async operations

            Critical scenarios:
            - Happy path user flow
            - Error handling
            - Edge cases

            Keep iterating until all tests pass.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - review
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: docs
          name: docs
          prompt: |
            Update documentation for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            1. Update any relevant documentation files
            2. Ensure CLAUDE.md reflects the changes if applicable
            3. Add/update code comments where needed
            4. Update README if user-facing changes were made

            Keep iterating until documentation is complete.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - test
          gate:
            type: auto
          checkpoint: true
          status: pending
        - id: validate
          name: validate
          prompt: |
            Final validation for:

            **Task**: {{TASK_TITLE}}

            **Description**: {{TASK_DESCRIPTION}}

            ## Validation Checklist

            ### Code
            - [ ] All requirements from spec are met
            - [ ] Unit tests pass: `go test ./... -v -race`
            - [ ] Test coverage > 80%
            - [ ] No race conditions
            - [ ] Code quality acceptable (no debug statements, TODOs)

            ### Integration
            - [ ] Components work together
            - [ ] Error handling is complete
            - [ ] Performance is acceptable

            ### E2E (If frontend - MUST RUN with Playwright MCP)
            - [ ] Main user flows work
            - [ ] Error states handled
            - [ ] UI updates correctly

            ### Documentation
            - [ ] Code is documented where needed
            - [ ] CLAUDE.md updated if necessary
            - [ ] API documented if applicable

            ## Final Verification

            If frontend exists, run E2E verification:
            1. Start all servers
            2. Use Playwright MCP tools to test all features
            3. Verify everything works end-to-end

            Keep iterating until validation passes.

            When done, output:
            <phase_complete>true</phase_complete>
          depends_on:
            - docs
          gate:
            type: auto
          checkpoint: true
          status: pending
state:
    task_id: TASK-412
    current_phase: ""
    current_iteration: 0
    status: pending
    started_at: 0001-01-01T00:00:00Z
    updated_at: 0001-01-01T00:00:00Z
    phases: {}
    tokens:
        input_tokens: 0
        output_tokens: 0
        total_tokens: 0
    cost:
        total_cost_usd: 0
